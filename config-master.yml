# ============================================================================
# Synap Master Node Configuration
# ============================================================================
# 
# Master node accepts all write operations and replicates to replicas
# Use this configuration for the master node in a replication cluster
#
# ============================================================================

# ============================================================================
# NETWORK
# ============================================================================
server:
  host: "0.0.0.0"
  port: 15500
  websocket_enabled: false

# ============================================================================
# MEMORY MANAGEMENT
# ============================================================================
kv_store:
  max_memory_mb: 4096
  eviction_policy: "lru"
  ttl_cleanup_interval_ms: 100
  allow_flush_commands: false

# ============================================================================
# QUEUE SYSTEM
# ============================================================================
queue:
  enabled: true
  max_depth: 100000
  ack_deadline_secs: 30
  default_max_retries: 3
  default_priority: 5

# ============================================================================
# RATE LIMITING
# ============================================================================
rate_limit:
  enabled: false
  requests_per_second: 1000
  burst_size: 100

# ============================================================================
# LOGGING
# ============================================================================
logging:
  level: "info"
  format: "json"

# ============================================================================
# PROTOCOLS
# ============================================================================
protocols:
  streamable_http:
    enabled: true
    path: "/api/v1/command"
  rest:
    enabled: true
    prefix: "/kv"

# ============================================================================
# REPLICATION (MASTER)
# ============================================================================
replication:
  enabled: true
  role: "master"
  
  # Address where master listens for replica connections
  replica_listen_address: "0.0.0.0:15501"
  
  # Performance tuning
  heartbeat_interval_ms: 1000
  max_lag_ms: 10000
  buffer_size_kb: 256
  replica_timeout_secs: 30
  auto_reconnect: true
  reconnect_delay_ms: 5000

# ============================================================================
# CLUSTER MODE
# ============================================================================
# Optional: Enable cluster mode for distributed deployments
# Note: Cluster mode is separate from replication mode
# - Replication: Master-Slave for HA (enabled above)
# - Cluster: Multi-node mesh for horizontal scaling
cluster:
  enabled: false  # Disabled by default for master-slave replication

  # Uncomment to enable cluster mode alongside replication
  # node_id: "master-node"
  # seeds: []
  # port: 15502
  # bind_address: "0.0.0.0"
  # heartbeat_interval_ms: 1000
  # node_timeout_secs: 5
  # gossip_interval_ms: 500
  # max_nodes: 100

# ============================================================================
# HIVEHUB.CLOUD INTEGRATION
# ============================================================================
# Optional: Enable for SaaS multi-tenancy
hub:
  enabled: false  # Disabled by default

  # Uncomment to enable HiveHub integration
  # api_base_url: "https://api.hivehub.cloud"
  # service_api_key: ""  # Set via SYNAP_HUB_SERVICE_API_KEY env var
  # cache_ttl_secs: 60
  # usage_report_interval_secs: 300
  # verbose_logging: false

# ============================================================================
# PERSISTENCE
# ============================================================================
persistence:
  enabled: true

  # Write-Ahead Log
  wal:
    enabled: true
    path: "/data/wal/synap.wal"
    buffer_size_kb: 64
    fsync_mode: "periodic"
    fsync_interval_ms: 1000
    max_size_mb: 1024

  # Snapshots
  snapshot:
    enabled: true
    directory: "/data/snapshots"
    interval_secs: 300
    operation_threshold: 10000
    max_snapshots: 10
    compression: false

