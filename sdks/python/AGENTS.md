<!-- RULEBOOK:START -->
# Project Rules

Generated by @hivellm/rulebook
Generated at: 2025-10-23T23:45:00.000Z

## Documentation Standards

Documentation should be well-organized in the `/docs` directory.

## Testing Requirements

**CRITICAL**: All features must have comprehensive tests.

- **Minimum Coverage**: 95%
- **Test Location**: `/tests` directory in project root
- **Test Execution**: 100% of tests MUST pass before moving to next task
- **Test First**: Write tests based on specifications before implementation

## Feature Development Workflow

**CRITICAL**: Follow this workflow for all feature development.

1. **Check Specifications First**:
   - Read `/docs/specs/` for feature specifications
   - Review `/docs/ARCHITECTURE.md` for system design
   - Check `/docs/ROADMAP.md` for implementation timeline
   - Review `/docs/DAG.md` for component dependencies

2. **Implement with Tests**:
   - Write tests in `/tests` directory first
   - Implement feature following specifications
   - Ensure tests pass and meet coverage threshold

3. **Quality Checks**:
   - Run code formatter
   - Run linter (must pass with no warnings)
   - Run all tests (must be 100% passing)
   - Verify coverage meets threshold

4. **Update Documentation**:
   - Update `/docs/ROADMAP.md` progress
   - Update feature specs if implementation differs
   - Document any deviations with justification

<!-- RULEBOOK:END -->


<!-- PYTHON:START -->
# Python Project Rules

## Python Configuration

**CRITICAL**: Use Python 3.11+ with strict type checking.

- **Version**: Python 3.11+
- **Type Hints**: Required for all functions and methods
- **Async**: Use async/await patterns with httpx
- **Package Manager**: pip with pyproject.toml

### pyproject.toml Requirements

```toml
[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[project]
name = "your-package"
version = "0.1.0"
description = "Package description"
readme = "README.md"
requires-python = ">=3.11"
license = "MIT"
authors = [
    { name = "Your Name", email = "your.email@example.com" }
]
dependencies = [
    "httpx>=0.27.0",
]

[project.optional-dependencies]
dev = [
    "pytest>=8.0.0",
    "pytest-asyncio>=0.23.0",
    "pytest-cov>=4.1.0",
    "ruff>=0.3.0",
    "mypy>=1.9.0",
]

[tool.pytest.ini_options]
minversion = "8.0"
testpaths = ["tests"]
asyncio_mode = "auto"
addopts = ["--strict-markers", "--cov=your_package", "--cov-report=term-missing"]

[tool.coverage.report]
fail_under = 95

[tool.mypy]
strict = true
warn_return_any = true
disallow_untyped_defs = true

[tool.ruff]
target-version = "py311"
line-length = 100

[tool.ruff.lint]
select = ["E", "W", "F", "I", "B", "C4", "UP", "ARG", "SIM"]
```

## Code Quality Standards

### Mandatory Quality Checks

**CRITICAL**: After implementing ANY feature, you MUST run these commands in order:

```bash
# 1. Format code
ruff format .

# 2. Check linting (MUST pass with no warnings)
ruff check .

# 3. Type check (MUST pass)
mypy your_package

# 4. Run all tests (MUST pass 100%)
pytest

# 5. Check coverage (MUST be >95%)
pytest --cov=your_package --cov-report=term-missing
```

**If ANY of these fail, you MUST fix the issues before committing.**

### Type Hints

- Use type hints for all functions
- Use `from __future__ import annotations` for forward references
- Use `TypeVar` for generics
- Use `Protocol` for structural subtyping

Example:
```python
from __future__ import annotations

from typing import TypeVar, Generic, Protocol

T = TypeVar("T")

class Storage(Protocol):
    """Protocol for storage implementations."""
    
    async def get(self, key: str) -> str | None:
        """Get value by key."""
        ...

async def process_data(data: dict[str, Any]) -> list[str]:
    """Process data and return results.
    
    Args:
        data: Input data dictionary
        
    Returns:
        List of processed strings
        
    Raises:
        ValueError: If data is invalid
    """
    if not data:
        raise ValueError("Data cannot be empty")
    
    return [str(v) for v in data.values()]
```

### Testing

- **Framework**: pytest with pytest-asyncio
- **Location**: `tests/` directory
- **Coverage**: pytest-cov
- **Coverage Threshold**: 95%+

Example test structure:
```python
import pytest
from unittest.mock import AsyncMock

@pytest.mark.asyncio
async def test_async_operation() -> None:
    """Test async operation."""
    # Arrange
    mock_client = AsyncMock()
    mock_client.execute.return_value = {"result": "success"}
    
    # Act
    result = await perform_operation(mock_client)
    
    # Assert
    assert result == "success"
    mock_client.execute.assert_called_once()
```

### Documentation

- Use docstrings for all public APIs
- Follow Google-style docstrings
- Include Args, Returns, Raises sections

Example:
```python
async def fetch_data(url: str, timeout: int = 30) -> dict[str, Any]:
    """Fetch data from URL.
    
    Args:
        url: The URL to fetch from
        timeout: Request timeout in seconds (default: 30)
        
    Returns:
        The fetched data as a dictionary
        
    Raises:
        ValueError: If URL is invalid
        NetworkError: If request fails
        
    Example:
        >>> data = await fetch_data("https://api.example.com/data")
        >>> print(data["status"])
    """
    if not url:
        raise ValueError("URL cannot be empty")
    
    # Implementation
    return {}
```

## Project Structure

```
project/
├── pyproject.toml          # Project configuration
├── README.md               # Project overview
├── CHANGELOG.md            # Version history
├── LICENSE                 # Project license
├── py.typed                # Type hints marker
├── .gitignore              # Git ignore patterns
├── your_package/
│   ├── __init__.py
│   ├── client.py
│   └── ...
├── tests/
│   ├── __init__.py
│   ├── test_client.py
│   └── ...
└── examples/
    └── basic_usage.py
```

## Async/Await Best Practices

- Use `async`/`await` for I/O operations
- Use `httpx.AsyncClient` for HTTP requests
- Support context managers with `__aenter__`/`__aexit__`
- Always close resources properly

Example:
```python
import httpx

class DataService:
    """Service for fetching data."""
    
    def __init__(self, base_url: str) -> None:
        self._client = httpx.AsyncClient(base_url=base_url)
        
    async def fetch(self, path: str) -> dict[str, Any]:
        """Fetch data from path."""
        response = await self._client.get(path)
        response.raise_for_status()
        return response.json()
        
    async def close(self) -> None:
        """Close the HTTP client."""
        await self._client.aclose()
        
    async def __aenter__(self) -> DataService:
        """Enter async context."""
        return self
        
    async def __aexit__(self, *args: Any) -> None:
        """Exit async context."""
        await self.close()
```

## Package Publication

### Publishing to PyPI

**Prerequisites:**
1. Create account at https://pypi.org
2. Generate API token from account settings
3. Create `~/.pypirc` with credentials

**Publishing Workflow:**

1. Update version in pyproject.toml
2. Update CHANGELOG.md
3. Run quality checks:
   ```bash
   ruff format .
   ruff check .
   mypy your_package
   pytest
   ```

4. Build: `python -m build`
5. Check: `twine check dist/*`
6. Upload to Test PyPI: `twine upload --repository testpypi dist/*`
7. Test installation: `pip install --index-url https://test.pypi.org/simple/ synap-sdk`
8. Upload to PyPI: `twine upload dist/*`
9. Create git tag: `git tag v0.1.0 && git push --tags`

**Publishing Checklist:**

- ✅ All tests passing
- ✅ Code formatted (`ruff format`)
- ✅ No linting warnings (`ruff check`)
- ✅ Type checking passes (`mypy`)
- ✅ Coverage ≥ 95%
- ✅ Version updated in pyproject.toml
- ✅ CHANGELOG.md updated
- ✅ README.md up to date
- ✅ LICENSE file present
- ✅ py.typed marker present
- ✅ Build succeeds (`python -m build`)
- ✅ Package check passes (`twine check dist/*`)

**Semantic Versioning:**

- **MAJOR**: Breaking API changes (1.0.0 → 2.0.0)
- **MINOR**: New features (backwards compatible) (1.0.0 → 1.1.0)
- **PATCH**: Bug fixes (backwards compatible) (1.0.0 → 1.0.1)

<!-- PYTHON:END -->

