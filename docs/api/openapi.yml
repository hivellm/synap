openapi: 3.0.3
info:
  title: Synap API
  description: |
    High-Performance In-Memory Key-Value Store & Message Broker

    Synap combines Redis, RabbitMQ, and Kafka features in a single platform:
    - **Key-Value Store**: Radix-tree based storage with TTL support
    - **Hash Store**: Redis-compatible hash data structure for structured objects
    - **Message Queues**: RabbitMQ-style queues with ACK/NACK
    - **Event Streams**: Kafka-style partitioned topics with consumer groups
    - **Pub/Sub**: Topic-based messaging with wildcard support

    **Authentication & Security** (âœ… Production Ready):
    - **Basic Auth**: HTTP Basic Authentication (username:password)
    - **Bearer Token**: API Key authentication via Authorization header
    - **API Key**: Query parameter authentication for GET requests
    - **User Management**: Create, delete, enable/disable users
    - **API Key Management**: Generate, revoke, and manage API keys with expiration
    - **Fine-grained Permissions**: Resource-based permissions (RabbitMQ-style)
    - **Audit Logging**: Track all authentication events
    - **Password Validation**: Configurable password requirements
  version: 0.9.0
  contact:
    name: Synap Team
    url: https://github.com/hivellm/synap
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:15500
    description: Local development server
  - url: https://api.synap.io
    description: Production server

tags:
  - name: Health
    description: Health check endpoints
  - name: Key-Value
    description: Redis-style key-value operations
  - name: Hash
    description: Redis-style hash operations (field-value maps)
  - name: Bitmap
    description: Redis-style bitmap operations
  - name: List
    description: Redis-style list operations
  - name: Set
    description: Redis-style set operations
  - name: Sorted Set
    description: Redis-style sorted set operations
  - name: HyperLogLog
    description: Redis-style HyperLogLog operations
  - name: Geospatial
    description: Redis-style geospatial operations
  - name: Transactions
    description: Redis-style transaction operations
  - name: Scripting
    description: Lua scripting operations
  - name: Queue
    description: RabbitMQ-style message queues
  - name: Event Streams (Simple)
    description: Room-based event streaming
  - name: Event Streams (Partitioned)
    description: Kafka-style partitioned topics
  - name: Consumer Groups
    description: Kafka-style consumer group coordination
  - name: Pub/Sub
    description: Topic-based publish/subscribe
  - name: Persistence
    description: Snapshot and persistence management
  - name: Authentication
    description: Authentication, user management, and API key management

paths:
  # ==========================================
  # Health Endpoints
  # ==========================================
  /health:
    get:
      tags: [Health]
      summary: Health check
      description: Check if the server is running and healthy
      operationId: healthCheck
      responses:
        "200":
          description: Server is healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: healthy
                  service:
                    type: string
                    example: synap
                  version:
                    type: string
                    example: 0.3.0-rc

  # ==========================================
  # Key-Value Endpoints
  # ==========================================
  /kv/set:
    post:
      tags: [Key-Value]
      summary: Set a key-value pair
      description: Store a value with optional TTL
      operationId: kvSet
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [key, value]
              properties:
                key:
                  type: string
                  example: user:123
                value:
                  type: object
                  example: { "name": "John Doe", "age": 30 }
                ttl:
                  type: integer
                  description: Time-to-live in seconds
                  example: 3600
      responses:
        "200":
          description: Key set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  key:
                    type: string
                    example: user:123

  /kv/get/{key}:
    get:
      tags: [Key-Value]
      summary: Get a value by key
      description: Retrieve the value associated with a key
      operationId: kvGet
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:123
      responses:
        "200":
          description: Value retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  found:
                    type: boolean
                    example: true
                  value:
                    type: object
                    example: { "name": "John Doe", "age": 30 }
                  ttl:
                    type: integer
                    nullable: true
                    example: 3456

  /kv/del/{key}:
    delete:
      tags: [Key-Value]
      summary: Delete a key
      description: Remove a key-value pair from the store
      operationId: kvDelete
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:123
      responses:
        "200":
          description: Key deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  deleted:
                    type: boolean
                    example: true
                  key:
                    type: string
                    example: user:123

  /kv/stats:
    get:
      tags: [Key-Value]
      summary: Get store statistics
      description: Retrieve statistics about the key-value store
      operationId: kvStats
      responses:
        "200":
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KVStats"

  # ==========================================
  # Hash Endpoints
  # ==========================================
  /hash/{key}/set:
    post:
      tags: [Hash]
      summary: Set a hash field
      description: Set a field value in a hash
      operationId: hashSet
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [field, value]
              properties:
                field:
                  type: string
                  example: name
                value:
                  description: Value (can be string, number, or object)
                  example: Alice
      responses:
        "200":
          description: Field set successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HashSetResponse"

  /hash/{key}/{field}:
    get:
      tags: [Hash]
      summary: Get a hash field value
      description: Retrieve the value of a field in a hash
      operationId: hashGet
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
        - name: field
          in: path
          required: true
          schema:
            type: string
          example: name
      responses:
        "200":
          description: Field value retrieved
          content:
            application/json:
              schema:
                description: Field value (string, number, or null if not found)
                example: Alice
        "404":
          description: Hash or field not found

  /hash/{key}/getall:
    get:
      tags: [Hash]
      summary: Get all hash fields
      description: Retrieve all field-value pairs in a hash
      operationId: hashGetAll
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
      responses:
        "200":
          description: All fields retrieved
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
                example:
                  name: Alice
                  age: 30
                  email: alice@example.com

  /hash/{key}/keys:
    get:
      tags: [Hash]
      summary: Get all field names
      description: Retrieve all field names in a hash
      operationId: hashKeys
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
      responses:
        "200":
          description: Field names retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  type: string
                example: [name, age, email]

  /hash/{key}/vals:
    get:
      tags: [Hash]
      summary: Get all field values
      description: Retrieve all values in a hash
      operationId: hashVals
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
      responses:
        "200":
          description: Values retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  description: Field value
                example: [Alice, 30, alice@example.com]

  /hash/{key}/len:
    get:
      tags: [Hash]
      summary: Get hash field count
      description: Get the number of fields in a hash
      operationId: hashLen
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
      responses:
        "200":
          description: Field count retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  length:
                    type: integer
                    example: 3

  /hash/{key}/mset:
    post:
      tags: [Hash]
      summary: Set multiple hash fields
      description: |
        Set multiple field-value pairs in a hash.

        **Supported Formats:**
        - Object format: `{"fields": {"name": "Alice", "age": 30}}`
        - Array format: `[{"field": "name", "value": "Alice"}, {"field": "age", "value": 30}]`
      operationId: hashMSet
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              oneOf:
                - type: object
                  required: [fields]
                  properties:
                    fields:
                      type: object
                      additionalProperties: true
                      example:
                        name: Alice
                        age: 30
                        email: alice@example.com
                - type: array
                  items:
                    type: object
                    required: [field, value]
                    properties:
                      field:
                        type: string
                        example: name
                      value:
                        description: Field value (any JSON type)
                        example: Alice
                  example:
                    - field: name
                      value: Alice
                    - field: age
                      value: 30
                    - field: email
                      value: alice@example.com
      responses:
        "200":
          description: Fields set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true

  /hash/{key}/mget:
    post:
      tags: [Hash]
      summary: Get multiple hash fields
      description: Retrieve values for multiple fields in a hash
      operationId: hashMGet
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [fields]
              properties:
                fields:
                  type: array
                  items:
                    type: string
                  example: [name, age, email]
      responses:
        "200":
          description: Field values retrieved
          content:
            application/json:
              schema:
                type: array
                items:
                  description: Field value (null if not found)
                example: [Alice, 30, alice@example.com]

  /hash/{key}/del:
    post:
      tags: [Hash]
      summary: Delete hash fields
      description: Delete one or more fields from a hash
      operationId: hashDel
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [fields]
              properties:
                fields:
                  type: array
                  items:
                    type: string
                  example: [email, age]
      responses:
        "200":
          description: Fields deleted
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HashDelResponse"

  /hash/{key}/{field}/exists:
    get:
      tags: [Hash]
      summary: Check field existence
      description: Check if a field exists in a hash
      operationId: hashExists
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
        - name: field
          in: path
          required: true
          schema:
            type: string
          example: name
      responses:
        "200":
          description: Existence check result
          content:
            application/json:
              schema:
                type: object
                properties:
                  exists:
                    type: boolean
                    example: true

  /hash/{key}/incrby:
    post:
      tags: [Hash]
      summary: Increment field by integer
      description: Atomically increment a hash field by an integer
      operationId: hashIncrBy
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: stats:user:1000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [field, increment]
              properties:
                field:
                  type: string
                  example: login_count
                increment:
                  type: integer
                  format: int64
                  example: 1
      responses:
        "200":
          description: Field incremented
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: integer
                    format: int64
                    example: 42

  /hash/{key}/incrbyfloat:
    post:
      tags: [Hash]
      summary: Increment field by float
      description: Atomically increment a hash field by a floating point number
      operationId: hashIncrByFloat
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: stats:metrics
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [field, increment]
              properties:
                field:
                  type: string
                  example: average_response_time
                increment:
                  type: number
                  format: double
                  example: 0.25
      responses:
        "200":
          description: Field incremented
          content:
            application/json:
              schema:
                type: object
                properties:
                  value:
                    type: number
                    format: double
                    example: 123.75

  /hash/{key}/setnx:
    post:
      tags: [Hash]
      summary: Set field if not exists
      description: Set a hash field only if it doesn't already exist
      operationId: hashSetNX
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:1000
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [field, value]
              properties:
                field:
                  type: string
                  example: created_at
                value:
                  description: Value to set
                  example: "2025-10-24T12:00:00Z"
      responses:
        "200":
          description: Set operation result
          content:
            application/json:
              schema:
                type: object
                properties:
                  created:
                    type: boolean
                    example: true

  /hash/stats:
    get:
      tags: [Hash]
      summary: Get hash statistics
      description: Retrieve statistics about the hash store
      operationId: hashStats
      responses:
        "200":
          description: Statistics retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HashStatsResponse"

  # ==========================================
  # Bitmap Endpoints
  # ==========================================
  /bitmap/{key}/setbit:
    post:
      tags: [Bitmap]
      summary: Set bit at offset
      description: Set a bit at a specific offset in a bitmap (0 or 1)
      operationId: bitmapSetBit
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:flags
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [offset, value]
              properties:
                offset:
                  type: integer
                  format: int64
                  description: Bit offset (0-based)
                  example: 5
                value:
                  type: integer
                  minimum: 0
                  maximum: 1
                  description: Bit value (0 or 1)
                  example: 1
      responses:
        "200":
          description: Bit set successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: user:flags
                  old_value:
                    type: integer
                    example: 0

  /bitmap/{key}/getbit/{offset}:
    get:
      tags: [Bitmap]
      summary: Get bit at offset
      description: Retrieve the value of a bit at a specific offset
      operationId: bitmapGetBit
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:flags
        - name: offset
          in: path
          required: true
          schema:
            type: integer
            format: int64
          example: 5
      responses:
        "200":
          description: Bit value retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: user:flags
                  offset:
                    type: integer
                    example: 5
                  value:
                    type: integer
                    example: 1

  /bitmap/{key}/bitcount:
    get:
      tags: [Bitmap]
      summary: Count set bits
      description: Count the number of bits set to 1 in a bitmap, optionally within a range
      operationId: bitmapBitCount
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:flags
        - name: start
          in: query
          schema:
            type: integer
            format: int64
          description: Start byte offset (optional)
          example: 0
        - name: end
          in: query
          schema:
            type: integer
            format: int64
          description: End byte offset (optional)
          example: 10
      responses:
        "200":
          description: Bit count retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: user:flags
                  count:
                    type: integer
                    example: 42

  /bitmap/{key}/bitpos:
    get:
      tags: [Bitmap]
      summary: Find first bit position
      description: Find the position of the first bit set to the specified value
      operationId: bitmapBitPos
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:flags
        - name: value
          in: query
          required: true
          schema:
            type: integer
            minimum: 0
            maximum: 1
          description: Bit value to search for (0 or 1)
          example: 1
        - name: start
          in: query
          schema:
            type: integer
            format: int64
          description: Start byte offset (optional)
          example: 0
        - name: end
          in: query
          schema:
            type: integer
            format: int64
          description: End byte offset (optional)
          example: 10
      responses:
        "200":
          description: Bit position found
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: user:flags
                  position:
                    type: integer
                    nullable: true
                    example: 7

  /bitmap/{destination}/bitop:
    post:
      tags: [Bitmap]
      summary: Perform bitwise operation
      description: Perform bitwise operations (AND, OR, XOR, NOT) on multiple bitmaps
      operationId: bitmapBitOp
      parameters:
        - name: destination
          in: path
          required: true
          schema:
            type: string
          example: result:flags
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [operation, source_keys]
              properties:
                operation:
                  type: string
                  enum: [AND, OR, XOR, NOT]
                  example: AND
                source_keys:
                  type: array
                  items:
                    type: string
                  example: [bitmap1, bitmap2]
      responses:
        "200":
          description: Bitwise operation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  destination:
                    type: string
                    example: result:flags
                  length:
                    type: integer
                    example: 128

  /bitmap/{key}/bitfield:
    post:
      tags: [Bitmap]
      summary: Execute bitfield operations
      description: Perform multiple bitfield operations (GET, SET, INCRBY) on a bitmap
      operationId: bitmapBitField
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: user:flags
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: "#/components/schemas/BitfieldOperation"
              example:
                - operation: SET
                  offset: 0
                  width: 8
                  signed: false
                  value: 42
                - operation: GET
                  offset: 0
                  width: 8
                  signed: false
                - operation: INCRBY
                  offset: 0
                  width: 8
                  signed: false
                  increment: 10
                  overflow: WRAP
      responses:
        "200":
          description: Bitfield operations completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: user:flags
                  results:
                    type: array
                    items:
                      type: integer
                      format: int64
                    example: [0, 42, 52]

  /bitmap/stats:
    get:
      tags: [Bitmap]
      summary: Get bitmap statistics
      description: Retrieve statistics about the bitmap store
      operationId: bitmapStats
      responses:
        "200":
          description: Statistics retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/BitmapStatsResponse"

  # ==========================================
  # HyperLogLog Endpoints
  # ==========================================
  /hyperloglog/{key}/pfadd:
    post:
      tags: [HyperLogLog]
      summary: Add elements to HyperLogLog
      description: Add one or more elements to a HyperLogLog structure for cardinality estimation
      operationId: hyperloglogPfAdd
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: unique-visitors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [elements]
              properties:
                elements:
                  type: array
                  items:
                    type: string
                  description: Elements to add to the HyperLogLog
                  example:
                    - "user:1"
                    - "user:2"
                    - "user:3"
                ttl_secs:
                  type: integer
                  format: int64
                  description: Optional TTL in seconds for the HyperLogLog
                  example: 3600
      responses:
        "200":
          description: Elements added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: unique-visitors
                  added:
                    type: integer
                    description: Number of elements estimated to be new (approximate)
                    example: 2

  /hyperloglog/{key}/pfcount:
    get:
      tags: [HyperLogLog]
      summary: Estimate cardinality
      description: Get the estimated cardinality (count of unique elements) of a HyperLogLog structure
      operationId: hyperloglogPfCount
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: unique-visitors
      responses:
        "200":
          description: Cardinality estimate retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: unique-visitors
                  count:
                    type: integer
                    format: int64
                    description: Estimated cardinality (approximate count of unique elements)
                    example: 1000

  /hyperloglog/{destination}/pfmerge:
    post:
      tags: [HyperLogLog]
      summary: Merge HyperLogLog structures
      description: Merge multiple HyperLogLog structures into a destination structure
      operationId: hyperloglogPfMerge
      parameters:
        - name: destination
          in: path
          required: true
          schema:
            type: string
          example: total-visitors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [sources]
              properties:
                sources:
                  type: array
                  items:
                    type: string
                  description: Source HyperLogLog keys to merge
                  example:
                    - "visitors:day1"
                    - "visitors:day2"
                    - "visitors:day3"
      responses:
        "200":
          description: HyperLogLog structures merged successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  destination:
                    type: string
                    example: total-visitors
                  count:
                    type: integer
                    format: int64
                    description: Estimated cardinality of merged result
                    example: 5000

  /hyperloglog/stats:
    get:
      tags: [HyperLogLog]
      summary: Get HyperLogLog statistics
      description: Retrieve statistics about the HyperLogLog store
      operationId: hyperloglogStats
      responses:
        "200":
          description: Statistics retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/HyperLogLogStatsResponse"

  # ==========================================
  # Geospatial Endpoints
  # ==========================================
  /geospatial/{key}/geoadd:
    post:
      tags: [Geospatial]
      summary: Add geospatial locations
      description: Add one or more geospatial items (latitude, longitude, member)
      operationId: geospatialGeoadd
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: cities
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [locations]
              properties:
                locations:
                  type: array
                  items:
                    type: object
                    required: [lat, lon, member]
                    properties:
                      lat:
                        type: number
                        format: double
                        example: 37.7749
                      lon:
                        type: number
                        format: double
                        example: -122.4194
                      member:
                        type: string
                        example: San Francisco
                nx:
                  type: boolean
                  description: Only add new elements (don't update existing)
                  default: false
                xx:
                  type: boolean
                  description: Only update existing elements (don't add new)
                  default: false
                ch:
                  type: boolean
                  description: Return count of changed elements
                  default: false
      responses:
        "200":
          description: Locations added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: cities
                  added:
                    type: integer
                    example: 1

  /geospatial/{key}/geodist/{member1}/{member2}:
    get:
      tags: [Geospatial]
      summary: Calculate distance between two members
      description: Get the distance between two geospatial members
      operationId: geospatialGeodist
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: cities
        - name: member1
          in: path
          required: true
          schema:
            type: string
          example: San Francisco
        - name: member2
          in: path
          required: true
          schema:
            type: string
          example: New York
        - name: unit
          in: query
          schema:
            type: string
            enum: [m, km, mi, ft]
            default: m
          description: Distance unit
      responses:
        "200":
          description: Distance calculated
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: cities
                  distance:
                    type: number
                    format: double
                    nullable: true
                    example: 4139.0
                  unit:
                    type: string
                    example: km

  /geospatial/{key}/georadius:
    get:
      tags: [Geospatial]
      summary: Query members within radius
      description: Find members within a radius of a given coordinate
      operationId: geospatialGeoradius
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: cities
        - name: center_lat
          in: query
          required: true
          schema:
            type: number
            format: double
          example: 37.7749
        - name: center_lon
          in: query
          required: true
          schema:
            type: number
            format: double
          example: -122.4194
        - name: radius
          in: query
          required: true
          schema:
            type: number
            format: double
          example: 50
        - name: unit
          in: query
          schema:
            type: string
            enum: [m, km, mi, ft]
            default: m
        - name: withdist
          in: query
          schema:
            type: boolean
            default: false
        - name: withcoord
          in: query
          schema:
            type: boolean
            default: false
        - name: count
          in: query
          schema:
            type: integer
          example: 10
        - name: sort
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
      responses:
        "200":
          description: Results retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: cities
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/GeoradiusResult"

  /geospatial/{key}/georadiusbymember/{member}:
    get:
      tags: [Geospatial]
      summary: Query members within radius of member
      description: Find members within a radius of a given member
      operationId: geospatialGeoradiusByMember
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: cities
        - name: member
          in: path
          required: true
          schema:
            type: string
          example: San Francisco
        - name: radius
          in: query
          required: true
          schema:
            type: number
            format: double
          example: 50
        - name: unit
          in: query
          schema:
            type: string
            enum: [m, km, mi, ft]
            default: m
        - name: withdist
          in: query
          schema:
            type: boolean
            default: false
        - name: withcoord
          in: query
          schema:
            type: boolean
            default: false
        - name: count
          in: query
          schema:
            type: integer
          example: 10
        - name: sort
          in: query
          schema:
            type: string
            enum: [ASC, DESC]
      responses:
        "200":
          description: Results retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: cities
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/GeoradiusResult"

  /geospatial/{key}/geopos:
    post:
      tags: [Geospatial]
      summary: Get coordinates of members
      description: Retrieve coordinates for one or more geospatial members
      operationId: geospatialGeopos
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: cities
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [members]
              properties:
                members:
                  type: array
                  items:
                    type: string
                  example: [San Francisco, New York]
      responses:
        "200":
          description: Coordinates retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: cities
                  coordinates:
                    type: array
                    items:
                      type: object
                      nullable: true
                      properties:
                        lat:
                          type: number
                          format: double
                        lon:
                          type: number
                          format: double

  /geospatial/{key}/geohash:
    post:
      tags: [Geospatial]
      summary: Get geohash strings
      description: Retrieve geohash strings for one or more geospatial members
      operationId: geospatialGeohash
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: cities
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [members]
              properties:
                members:
                  type: array
                  items:
                    type: string
                  example: [San Francisco, New York]
      responses:
        "200":
          description: Geohashes retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: cities
                  geohashes:
                    type: array
                    items:
                      type: string
                      nullable: true
                      example: 9q8yyk0j8w0

  /geospatial/{key}/geosearch:
    post:
      tags: [Geospatial]
      summary: Advanced geospatial search
      description: Search geospatial data using FROMMEMBER/FROMLONLAT and BYRADIUS/BYBOX
      operationId: geospatialGeosearch
      parameters:
        - name: key
          in: path
          required: true
          schema:
            type: string
          example: cities
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GeospatialSearchRequest"
      responses:
        "200":
          description: Search results retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  key:
                    type: string
                    example: cities
                  results:
                    type: array
                    items:
                      $ref: "#/components/schemas/GeoradiusResult"

  /geospatial/stats:
    get:
      tags: [Geospatial]
      summary: Get geospatial statistics
      description: Retrieve statistics about the geospatial store
      operationId: geospatialStats
      responses:
        "200":
          description: Statistics retrieved
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GeospatialStatsResponse"

  # ==========================================
  # Queue Endpoints
  # ==========================================
  /queue/{name}:
    post:
      tags: [Queue]
      summary: Create a queue
      description: Create a new message queue with configuration
      operationId: queueCreate
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          example: tasks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateQueueRequest"
      responses:
        "200":
          description: Queue created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  queue:
                    type: string
                    example: tasks
    delete:
      tags: [Queue]
      summary: Delete a queue
      description: Delete a queue and all its messages
      operationId: queueDelete
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          example: tasks
      responses:
        "200":
          description: Queue deleted successfully

  /queue/{name}/publish:
    post:
      tags: [Queue]
      summary: Publish a message
      description: Add a message to the queue
      operationId: queuePublish
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          example: tasks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PublishRequest"
      responses:
        "200":
          description: Message published successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PublishResponse"

  /queue/{name}/consume/{consumer_id}:
    get:
      tags: [Queue]
      summary: Consume a message
      description: Retrieve a message from the queue (one-time)
      operationId: queueConsume
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          example: tasks
        - name: consumer_id
          in: path
          required: true
          schema:
            type: string
          example: worker-1
      responses:
        "200":
          description: Message consumed successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsumeResponse"

  /queue/{name}/ack:
    post:
      tags: [Queue]
      summary: Acknowledge a message
      description: Confirm successful processing of a message
      operationId: queueAck
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          example: tasks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [message_id]
              properties:
                message_id:
                  type: string
                  example: msg_abc123xyz
      responses:
        "200":
          description: Message acknowledged successfully

  /queue/{name}/nack:
    post:
      tags: [Queue]
      summary: Negative acknowledge
      description: Reject a message and optionally requeue it
      operationId: queueNack
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          example: tasks
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [message_id]
              properties:
                message_id:
                  type: string
                  example: msg_abc123xyz
                requeue:
                  type: boolean
                  default: true
                  example: true
      responses:
        "200":
          description: Message rejected successfully

  /queue/{name}/stats:
    get:
      tags: [Queue]
      summary: Get queue statistics
      description: Retrieve statistics about a queue
      operationId: queueStats
      parameters:
        - name: name
          in: path
          required: true
          schema:
            type: string
          example: tasks
      responses:
        "200":
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/QueueStats"

  /queue/list:
    get:
      tags: [Queue]
      summary: List all queues
      description: Get a list of all queues
      operationId: queueList
      responses:
        "200":
          description: Queue list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  queues:
                    type: array
                    items:
                      type: string
                    example: [tasks, emails, notifications]

  # ==========================================
  # Event Streams (Simple)
  # ==========================================
  /stream/{room}:
    post:
      tags: [Event Streams (Simple)]
      summary: Create a room
      description: Create a new event stream room
      operationId: streamCreateRoom
      parameters:
        - name: room
          in: path
          required: true
          schema:
            type: string
          example: chat-room-1
      responses:
        "200":
          description: Room created successfully
    delete:
      tags: [Event Streams (Simple)]
      summary: Delete a room
      description: Delete an event stream room
      operationId: streamDeleteRoom
      parameters:
        - name: room
          in: path
          required: true
          schema:
            type: string
          example: chat-room-1
      responses:
        "200":
          description: Room deleted successfully

  /stream/{room}/publish:
    post:
      tags: [Event Streams (Simple)]
      summary: Publish an event
      description: Publish an event to a room
      operationId: streamPublish
      parameters:
        - name: room
          in: path
          required: true
          schema:
            type: string
          example: chat-room-1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/StreamPublishRequest"
      responses:
        "200":
          description: Event published successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StreamPublishResponse"

  /stream/{room}/consume/{subscriber_id}:
    get:
      tags: [Event Streams (Simple)]
      summary: Consume events
      description: Retrieve events from a room starting from an offset
      operationId: streamConsume
      parameters:
        - name: room
          in: path
          required: true
          schema:
            type: string
          example: chat-room-1
        - name: subscriber_id
          in: path
          required: true
          schema:
            type: string
          example: user-123
        - name: from_offset
          in: query
          schema:
            type: integer
            default: 0
          example: 0
        - name: limit
          in: query
          schema:
            type: integer
            default: 100
          example: 50
      responses:
        "200":
          description: Events retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/StreamConsumeResponse"

  /stream/{room}/stats:
    get:
      tags: [Event Streams (Simple)]
      summary: Get room statistics
      description: Retrieve statistics about a room
      operationId: streamRoomStats
      parameters:
        - name: room
          in: path
          required: true
          schema:
            type: string
          example: chat-room-1
      responses:
        "200":
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/RoomStats"

  /stream/list:
    get:
      tags: [Event Streams (Simple)]
      summary: List all rooms
      description: Get a list of all event stream rooms
      operationId: streamListRooms
      responses:
        "200":
          description: Room list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  rooms:
                    type: array
                    items:
                      type: string
                    example: [chat-room-1, game-lobby-42]
                  count:
                    type: integer
                    example: 2

  # ==========================================
  # Event Streams (Partitioned - Kafka-style)
  # ==========================================
  /topics:
    get:
      tags: [Event Streams (Partitioned)]
      summary: List all topics
      description: Get a list of all partitioned topics
      operationId: listTopics
      responses:
        "200":
          description: Topic list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  topics:
                    type: array
                    items:
                      type: string
                    example: [orders, events, logs]
                  count:
                    type: integer
                    example: 3

  /topics/{topic}:
    post:
      tags: [Event Streams (Partitioned)]
      summary: Create a partitioned topic
      description: Create a new topic with partitions and retention policy
      operationId: createPartitionedTopic
      parameters:
        - name: topic
          in: path
          required: true
          schema:
            type: string
          example: orders
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateTopicRequest"
      responses:
        "200":
          description: Topic created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  topic:
                    type: string
                    example: orders
                  num_partitions:
                    type: integer
                    example: 3
                  replication_factor:
                    type: integer
                    example: 1
    delete:
      tags: [Event Streams (Partitioned)]
      summary: Delete a topic
      description: Delete a partitioned topic
      operationId: deleteTopic
      parameters:
        - name: topic
          in: path
          required: true
          schema:
            type: string
          example: orders
      responses:
        "200":
          description: Topic deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  deleted:
                    type: string
                    example: orders

  /topics/{topic}/stats:
    get:
      tags: [Event Streams (Partitioned)]
      summary: Get topic statistics
      description: Retrieve statistics for all partitions in a topic
      operationId: getTopicStats
      parameters:
        - name: topic
          in: path
          required: true
          schema:
            type: string
          example: orders
      responses:
        "200":
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  topic:
                    type: string
                    example: orders
                  partitions:
                    type: array
                    items:
                      $ref: "#/components/schemas/PartitionStats"

  /topics/{topic}/publish:
    post:
      tags: [Event Streams (Partitioned)]
      summary: Publish to topic
      description: Publish an event to a partitioned topic (key-based or round-robin routing)
      operationId: publishToPartition
      parameters:
        - name: topic
          in: path
          required: true
          schema:
            type: string
          example: orders
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PartitionPublishRequest"
      responses:
        "200":
          description: Event published successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  partition_id:
                    type: integer
                    example: 2
                  offset:
                    type: integer
                    format: int64
                    example: 1234
                  topic:
                    type: string
                    example: orders

  /topics/{topic}/partitions/{partition_id}/consume:
    post:
      tags: [Event Streams (Partitioned)]
      summary: Consume from partition
      description: Consume events from a specific partition
      operationId: consumeFromPartition
      parameters:
        - name: topic
          in: path
          required: true
          schema:
            type: string
          example: orders
        - name: partition_id
          in: path
          required: true
          schema:
            type: integer
          example: 2
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ConsumePartitionRequest"
      responses:
        "200":
          description: Events consumed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  topic:
                    type: string
                    example: orders
                  partition_id:
                    type: integer
                    example: 2
                  events:
                    type: array
                    items:
                      $ref: "#/components/schemas/PartitionEvent"
                  next_offset:
                    type: integer
                    format: int64
                    example: 1101
                  count:
                    type: integer
                    example: 100

  # ==========================================
  # Consumer Groups
  # ==========================================
  /consumer-groups:
    get:
      tags: [Consumer Groups]
      summary: List consumer groups
      description: Get a list of all consumer groups
      operationId: listConsumerGroups
      responses:
        "200":
          description: Consumer group list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  groups:
                    type: array
                    items:
                      type: string
                    example: [order-processors, log-aggregators]
                  count:
                    type: integer
                    example: 2

  /consumer-groups/{group_id}:
    post:
      tags: [Consumer Groups]
      summary: Create consumer group
      description: Create a new consumer group for a topic
      operationId: createConsumerGroup
      parameters:
        - name: group_id
          in: path
          required: true
          schema:
            type: string
          example: order-processors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateConsumerGroupRequest"
      responses:
        "200":
          description: Consumer group created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  group_id:
                    type: string
                    example: order-processors
                  topic:
                    type: string
                    example: orders

  /consumer-groups/{group_id}/join:
    post:
      tags: [Consumer Groups]
      summary: Join consumer group
      description: Join a consumer group and get assigned partitions
      operationId: joinConsumerGroup
      parameters:
        - name: group_id
          in: path
          required: true
          schema:
            type: string
          example: order-processors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/JoinGroupRequest"
      responses:
        "200":
          description: Successfully joined consumer group
          content:
            application/json:
              schema:
                type: object
                properties:
                  member_id:
                    type: string
                    example: 550e8400-e29b-41d4-a716-446655440000
                  group_id:
                    type: string
                    example: order-processors

  /consumer-groups/{group_id}/members/{member_id}/leave:
    delete:
      tags: [Consumer Groups]
      summary: Leave consumer group
      description: Leave a consumer group and trigger rebalancing
      operationId: leaveConsumerGroup
      parameters:
        - name: group_id
          in: path
          required: true
          schema:
            type: string
          example: order-processors
        - name: member_id
          in: path
          required: true
          schema:
            type: string
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        "200":
          description: Successfully left consumer group
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  member_id:
                    type: string
                    example: 550e8400-e29b-41d4-a716-446655440000

  /consumer-groups/{group_id}/members/{member_id}/assignment:
    get:
      tags: [Consumer Groups]
      summary: Get partition assignment
      description: Get the partition assignment for a consumer
      operationId: getPartitionAssignment
      parameters:
        - name: group_id
          in: path
          required: true
          schema:
            type: string
          example: order-processors
        - name: member_id
          in: path
          required: true
          schema:
            type: string
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        "200":
          description: Assignment retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  member_id:
                    type: string
                    example: 550e8400-e29b-41d4-a716-446655440000
                  group_id:
                    type: string
                    example: order-processors
                  partitions:
                    type: array
                    items:
                      type: integer
                    example: [0, 3]

  /consumer-groups/{group_id}/members/{member_id}/heartbeat:
    post:
      tags: [Consumer Groups]
      summary: Send heartbeat
      description: Send a heartbeat to keep the consumer alive in the group
      operationId: consumerHeartbeat
      parameters:
        - name: group_id
          in: path
          required: true
          schema:
            type: string
          example: order-processors
        - name: member_id
          in: path
          required: true
          schema:
            type: string
          example: 550e8400-e29b-41d4-a716-446655440000
      responses:
        "200":
          description: Heartbeat accepted
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true

  /consumer-groups/{group_id}/offsets/commit:
    post:
      tags: [Consumer Groups]
      summary: Commit offset
      description: Commit the current offset for a partition
      operationId: commitOffset
      parameters:
        - name: group_id
          in: path
          required: true
          schema:
            type: string
          example: order-processors
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CommitOffsetRequest"
      responses:
        "200":
          description: Offset committed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  partition_id:
                    type: integer
                    example: 0
                  offset:
                    type: integer
                    format: int64
                    example: 1500

  /consumer-groups/{group_id}/offsets/{partition_id}:
    get:
      tags: [Consumer Groups]
      summary: Get committed offset
      description: Retrieve the committed offset for a partition
      operationId: getCommittedOffset
      parameters:
        - name: group_id
          in: path
          required: true
          schema:
            type: string
          example: order-processors
        - name: partition_id
          in: path
          required: true
          schema:
            type: integer
          example: 0
      responses:
        "200":
          description: Offset retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  group_id:
                    type: string
                    example: order-processors
                  partition_id:
                    type: integer
                    example: 0
                  offset:
                    type: integer
                    format: int64
                    nullable: true
                    example: 1500

  /consumer-groups/{group_id}/stats:
    get:
      tags: [Consumer Groups]
      summary: Get consumer group stats
      description: Retrieve statistics about a consumer group
      operationId: getConsumerGroupStats
      parameters:
        - name: group_id
          in: path
          required: true
          schema:
            type: string
          example: order-processors
      responses:
        "200":
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ConsumerGroupStats"

  # ==========================================
  # Pub/Sub Endpoints
  # ==========================================
  /pubsub/{topic}/publish:
    post:
      tags: [Pub/Sub]
      summary: Publish message
      description: |
        Publish a message to a pub/sub topic.

        **Supported Fields:**
        - `payload` (preferred): Message payload (any JSON type)
        - `data` (alias): Alternative field name for payload (for SDK compatibility)
        - `metadata` (optional): Additional metadata as key-value pairs
      operationId: pubsubPublish
      parameters:
        - name: topic
          in: path
          required: true
          schema:
            type: string
          example: notifications.email
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                payload:
                  description: Message payload (preferred field name)
                  example: { "to": "user@example.com", "subject": "Welcome" }
                data:
                  description: Message payload (alias for SDK compatibility)
                  example: { "to": "user@example.com", "subject": "Welcome" }
                metadata:
                  type: object
                  additionalProperties:
                    type: string
                  description: Optional metadata key-value pairs
                  example:
                    source: web-app
                    priority: high
              anyOf:
                - required: [payload]
                - required: [data]
      responses:
        "200":
          description: Message published successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  subscribers_notified:
                    type: integer
                    example: 5

  /pubsub/stats:
    get:
      tags: [Pub/Sub]
      summary: Get pub/sub statistics
      description: Retrieve statistics about the pub/sub system
      operationId: pubsubStats
      responses:
        "200":
          description: Statistics retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PubSubStats"

  /pubsub/topics:
    get:
      tags: [Pub/Sub]
      summary: List topics
      description: Get a list of all pub/sub topics
      operationId: pubsubListTopics
      responses:
        "200":
          description: Topic list retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  topics:
                    type: array
                    items:
                      type: string
                    example:
                      [
                        notifications.email,
                        notifications.sms,
                        events.user.login,
                      ]

  /pubsub/{topic}/info:
    get:
      tags: [Pub/Sub]
      summary: Get topic info
      description: Get information about a specific topic
      operationId: pubsubTopicInfo
      parameters:
        - name: topic
          in: path
          required: true
          schema:
            type: string
          example: notifications.email
      responses:
        "200":
          description: Topic info retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TopicInfo"

  # ==========================================
  # Authentication Endpoints
  # ==========================================
  /auth/login:
    post:
      tags: [Authentication]
      summary: Login with username/password
      description: Authenticate using username and password (returns user info, use Basic Auth for API calls)
      operationId: authLogin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [username, password]
              properties:
                username:
                  type: string
                  example: admin
                password:
                  type: string
                  format: password
                  example: SecurePassword123!
      responses:
        "200":
          description: Login response
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  user:
                    $ref: "#/components/schemas/UserInfo"
                  message:
                    type: string
                    example: Login successful

  /auth/me:
    get:
      tags: [Authentication]
      summary: Get current user info
      description: Get information about the currently authenticated user
      operationId: authMe
      security:
        - BasicAuth: []
        - BearerAuth: []
      responses:
        "200":
          description: User information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfo"
        "401":
          description: Unauthorized

  /auth/keys:
    post:
      tags: [Authentication]
      summary: Create API key
      description: Generate a new API key with optional expiration and permissions
      operationId: authCreateKey
      security:
        - BasicAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateKeyRequest"
      responses:
        "200":
          description: API key created successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CreateKeyResponse"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (insufficient permissions)
    get:
      tags: [Authentication]
      summary: List API keys
      description: List all API keys for the authenticated user
      operationId: authListKeys
      security:
        - BasicAuth: []
        - BearerAuth: []
      responses:
        "200":
          description: List of API keys
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  keys:
                    type: array
                    items:
                      $ref: "#/components/schemas/ApiKeyInfo"
        "401":
          description: Unauthorized

  /auth/keys/{id}:
    delete:
      tags: [Authentication]
      summary: Revoke API key
      description: Revoke (delete) an API key by ID
      operationId: authRevokeKey
      security:
        - BasicAuth: []
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: string
          example: key_abc123xyz
      responses:
        "200":
          description: API key revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: API key revoked
        "401":
          description: Unauthorized
        "404":
          description: API key not found

  /auth/users:
    post:
      tags: [Authentication]
      summary: Create user (Admin only)
      description: Create a new user account (requires admin permissions)
      operationId: authCreateUser
      security:
        - BasicAuth: []
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/CreateUserRequest"
      responses:
        "200":
          description: User created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  username:
                    type: string
                    example: newuser
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin required)
    get:
      tags: [Authentication]
      summary: List users (Admin only)
      description: Get a list of all users (requires admin permissions)
      operationId: authListUsers
      security:
        - BasicAuth: []
        - BearerAuth: []
      responses:
        "200":
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/UserInfo"
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin required)

  /auth/users/{username}:
    get:
      tags: [Authentication]
      summary: Get user details
      description: Get detailed information about a specific user
      operationId: authGetUser
      security:
        - BasicAuth: []
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          example: admin
      responses:
        "200":
          description: User information
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/UserInfo"
        "401":
          description: Unauthorized
        "404":
          description: User not found
    delete:
      tags: [Authentication]
      summary: Delete user (Admin only)
      description: Delete a user account (cannot delete root user)
      operationId: authDeleteUser
      security:
        - BasicAuth: []
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          example: olduser
      responses:
        "200":
          description: User deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin required)
        "400":
          description: Cannot delete root user

  /auth/users/{username}/password:
    post:
      tags: [Authentication]
      summary: Change user password
      description: Change password for a user (users can change their own password, admins can change any password)
      operationId: authChangePassword
      security:
        - BasicAuth: []
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          example: admin
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [new_password]
              properties:
                new_password:
                  type: string
                  format: password
                  example: NewSecurePassword123!
      responses:
        "200":
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        "401":
          description: Unauthorized
        "400":
          description: Invalid password (doesn't meet requirements)

  /auth/users/{username}/enable:
    post:
      tags: [Authentication]
      summary: Enable user (Admin only)
      description: Enable a disabled user account
      operationId: authEnableUser
      security:
        - BasicAuth: []
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          example: disableduser
      responses:
        "200":
          description: User enabled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin required)

  /auth/users/{username}/disable:
    post:
      tags: [Authentication]
      summary: Disable user (Admin only)
      description: Disable a user account (prevents login)
      operationId: authDisableUser
      security:
        - BasicAuth: []
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          example: problematicuser
      responses:
        "200":
          description: User disabled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin required)

  /auth/users/{username}/roles:
    post:
      tags: [Authentication]
      summary: Grant role to user (Admin only)
      description: Assign a role to a user
      operationId: authGrantRole
      security:
        - BasicAuth: []
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          example: newuser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [role]
              properties:
                role:
                  type: string
                  example: readonly
      responses:
        "200":
          description: Role granted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin required)

  /auth/users/{username}/roles/{role}:
    delete:
      tags: [Authentication]
      summary: Revoke role from user (Admin only)
      description: Remove a role from a user
      operationId: authRevokeRole
      security:
        - BasicAuth: []
        - BearerAuth: []
      parameters:
        - name: username
          in: path
          required: true
          schema:
            type: string
          example: newuser
        - name: role
          in: path
          required: true
          schema:
            type: string
          example: readonly
      responses:
        "200":
          description: Role revoked successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
        "401":
          description: Unauthorized
        "403":
          description: Forbidden (admin required)

  /auth/roles:
    get:
      tags: [Authentication]
      summary: List roles
      description: Get a list of all available roles
      operationId: authListRoles
      security:
        - BasicAuth: []
        - BearerAuth: []
      responses:
        "200":
          description: List of roles
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/RoleInfo"
        "401":
          description: Unauthorized

  # ==========================================
  # Persistence Endpoints
  # ==========================================
  /snapshot:
    post:
      tags: [Persistence]
      summary: Trigger snapshot
      description: Manually trigger a snapshot creation
      operationId: triggerSnapshot
      responses:
        "200":
          description: Snapshot created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Snapshot created

components:
  securitySchemes:
    BasicAuth:
      type: http
      scheme: basic
      description: HTTP Basic Authentication (username:password)

    BearerAuth:
      type: http
      scheme: bearer
      description: API Key as Bearer token

    ApiKeyAuth:
      type: apiKey
      in: query
      name: api_key
      description: API Key in query parameter

  schemas:
    # KV Schemas
    KVStats:
      type: object
      properties:
        total_keys:
          type: integer
          example: 10000
        total_memory_bytes:
          type: integer
          example: 524288
        operations:
          type: object
          properties:
            gets:
              type: integer
              format: int64
              example: 50000
            sets:
              type: integer
              format: int64
              example: 10000
            dels:
              type: integer
              format: int64
              example: 1000
            hits:
              type: integer
              format: int64
              example: 45000
            misses:
              type: integer
              format: int64
              example: 5000
        hit_rate:
          type: number
          format: float
          example: 0.9

    # Hash Schemas
    HashSetResponse:
      type: object
      properties:
        created:
          type: boolean
          description: True if field was created, false if updated
          example: true

    HashDelResponse:
      type: object
      properties:
        deleted:
          type: integer
          description: Number of fields deleted
          example: 2

    HashStatsResponse:
      type: object
      properties:
        total_hashes:
          type: integer
          description: Total number of hashes
          example: 1000
        total_fields:
          type: integer
          format: int64
          description: Total number of fields across all hashes
          example: 50000
        total_memory_bytes:
          type: integer
          format: int64
          description: Total memory used by hash storage
          example: 2097152
        operations:
          type: object
          properties:
            hset_count:
              type: integer
              format: int64
              description: Total HSET operations
              example: 10000
            hget_count:
              type: integer
              format: int64
              description: Total HGET operations
              example: 50000
            hdel_count:
              type: integer
              format: int64
              description: Total HDEL operations
              example: 500
            hgetall_count:
              type: integer
              format: int64
              description: Total HGETALL operations
              example: 5000
            hmset_count:
              type: integer
              format: int64
              description: Total HMSET operations
              example: 2000
            hmget_count:
              type: integer
              format: int64
              description: Total HMGET operations
              example: 8000
            hincrby_count:
              type: integer
              format: int64
              description: Total HINCRBY operations
              example: 1500
            hincrbyfloat_count:
              type: integer
              format: int64
              description: Total HINCRBYFLOAT operations
              example: 500
            hexists_count:
              type: integer
              format: int64
              description: Total HEXISTS operations
              example: 15000
            hlen_count:
              type: integer
              format: int64
              description: Total HLEN operations
              example: 3000
            hkeys_count:
              type: integer
              format: int64
              description: Total HKEYS operations
              example: 1000
            hvals_count:
              type: integer
              format: int64
              description: Total HVALS operations
              example: 1000
            hsetnx_count:
              type: integer
              format: int64
              description: Total HSETNX operations
              example: 800

    # Queue Schemas
    CreateQueueRequest:
      type: object
      properties:
        max_depth:
          type: integer
          default: 10000
          example: 10000
        ack_deadline_secs:
          type: integer
          format: int64
          default: 30
          example: 30
        default_max_retries:
          type: integer
          default: 3
          example: 3
        default_priority:
          type: integer
          minimum: 0
          maximum: 9
          default: 5
          example: 5

    PublishRequest:
      type: object
      required: [payload]
      properties:
        payload:
          type: array
          items:
            type: integer
            minimum: 0
            maximum: 255
          example: [72, 101, 108, 108, 111]
        priority:
          type: integer
          minimum: 0
          maximum: 9
          default: 5
          example: 9
        max_retries:
          type: integer
          default: 3
          example: 3
        headers:
          type: object
          additionalProperties:
            type: string
          example: { "content-type": "application/json" }

    PublishResponse:
      type: object
      properties:
        message_id:
          type: string
          example: msg_abc123xyz
        queue:
          type: string
          example: tasks

    ConsumeResponse:
      type: object
      properties:
        message_id:
          type: string
          nullable: true
          example: msg_abc123xyz
        payload:
          type: array
          items:
            type: integer
          nullable: true
          example: [72, 101, 108, 108, 111]
        priority:
          type: integer
          nullable: true
          example: 9
        retry_count:
          type: integer
          nullable: true
          example: 0
        headers:
          type: object
          additionalProperties:
            type: string
          nullable: true

    QueueStats:
      type: object
      properties:
        name:
          type: string
          example: tasks
        depth:
          type: integer
          example: 150
        pending:
          type: integer
          example: 25
        total_published:
          type: integer
          format: int64
          example: 10000
        total_consumed:
          type: integer
          format: int64
          example: 9500
        total_acked:
          type: integer
          format: int64
          example: 9450
        total_nacked:
          type: integer
          format: int64
          example: 50
        dlq_count:
          type: integer
          example: 5

    # Stream Schemas
    StreamPublishRequest:
      type: object
      required: [event, data]
      properties:
        event:
          type: string
          example: message
        data:
          type: object
          example: { "user": "alice", "text": "Hello!" }

    StreamPublishResponse:
      type: object
      properties:
        offset:
          type: integer
          format: int64
          example: 42
        room:
          type: string
          example: chat-room-1

    StreamConsumeResponse:
      type: object
      properties:
        events:
          type: array
          items:
            $ref: "#/components/schemas/StreamEvent"
        next_offset:
          type: integer
          format: int64
          example: 50

    StreamEvent:
      type: object
      properties:
        id:
          type: string
          example: evt_abc123
        offset:
          type: integer
          format: int64
          example: 42
        room:
          type: string
          example: chat-room-1
        event:
          type: string
          example: message
        data:
          type: array
          items:
            type: integer
          example: [72, 101, 108, 108, 111]
        timestamp:
          type: integer
          format: int64
          example: 1729598400
        metadata:
          type: object
          additionalProperties:
            type: string

    RoomStats:
      type: object
      properties:
        name:
          type: string
          example: chat-room-1
        message_count:
          type: integer
          example: 1500
        min_offset:
          type: integer
          format: int64
          example: 0
        max_offset:
          type: integer
          format: int64
          example: 1499
        subscriber_count:
          type: integer
          example: 5
        total_published:
          type: integer
          format: int64
          example: 2000
        total_consumed:
          type: integer
          format: int64
          example: 7500

    # Partitioned Streams Schemas
    CreateTopicRequest:
      type: object
      properties:
        num_partitions:
          type: integer
          default: 3
          example: 3
        replication_factor:
          type: integer
          default: 1
          example: 1
        retention_policy:
          $ref: "#/components/schemas/RetentionPolicy"
        segment_bytes:
          type: integer
          format: int64
          default: 104857600
          example: 104857600

    RetentionPolicy:
      type: object
      required: [type]
      properties:
        type:
          type: string
          enum: [Time, Size, Messages, Combined, Infinite]
          example: Combined
        retention_secs:
          type: integer
          format: int64
          nullable: true
          example: 3600
        max_bytes:
          type: integer
          format: int64
          nullable: true
          example: 104857600
        max_messages:
          type: integer
          format: int64
          nullable: true
          example: 100000

    PartitionPublishRequest:
      type: object
      required: [event_type, data]
      properties:
        event_type:
          type: string
          example: order.created
        key:
          type: string
          nullable: true
          description: Partition key for hash-based routing
          example: customer-123
        data:
          type: object
          example: { "order_id": "ORD-456", "amount": 99.99 }

    ConsumePartitionRequest:
      type: object
      properties:
        from_offset:
          type: integer
          format: int64
          default: 0
          example: 1000
        limit:
          type: integer
          default: 100
          example: 100

    PartitionEvent:
      type: object
      properties:
        id:
          type: string
          example: evt-001
        partition_id:
          type: integer
          example: 2
        offset:
          type: integer
          format: int64
          example: 1000
        topic:
          type: string
          example: orders
        event_type:
          type: string
          example: order.created
        key:
          type: array
          items:
            type: integer
          nullable: true
          example: [99, 117, 115, 116, 111, 109, 101, 114]
        data:
          type: array
          items:
            type: integer
          example:
            [
              123,
              34,
              97,
              109,
              111,
              117,
              110,
              116,
              34,
              58,
              57,
              57,
              46,
              57,
              57,
              125,
            ]
        timestamp:
          type: integer
          format: int64
          example: 1729598400
        size_bytes:
          type: integer
          format: int64
          example: 256
        metadata:
          type: object
          additionalProperties:
            type: string

    PartitionStats:
      type: object
      properties:
        partition_id:
          type: integer
          example: 0
        topic:
          type: string
          example: orders
        message_count:
          type: integer
          format: int64
          example: 1500
        total_bytes:
          type: integer
          format: int64
          example: 384000
        min_offset:
          type: integer
          format: int64
          example: 0
        max_offset:
          type: integer
          format: int64
          example: 1499
        last_compaction:
          type: integer
          format: int64
          example: 60

    # Consumer Group Schemas
    CreateConsumerGroupRequest:
      type: object
      required: [topic, partition_count]
      properties:
        topic:
          type: string
          example: orders
        partition_count:
          type: integer
          example: 3
        strategy:
          type: string
          enum: [round_robin, range, sticky]
          default: round_robin
          example: round_robin
        session_timeout_secs:
          type: integer
          format: int64
          default: 30
          example: 30

    JoinGroupRequest:
      type: object
      properties:
        session_timeout_secs:
          type: integer
          format: int64
          default: 30
          example: 30

    CommitOffsetRequest:
      type: object
      required: [partition_id, offset]
      properties:
        partition_id:
          type: integer
          example: 0
        offset:
          type: integer
          format: int64
          example: 1500

    ConsumerGroupStats:
      type: object
      properties:
        group_id:
          type: string
          example: order-processors
        topic:
          type: string
          example: orders
        state:
          type: string
          enum: [Empty, Stable, Rebalancing, Dead]
          example: Stable
        member_count:
          type: integer
          example: 3
        generation:
          type: integer
          format: int64
          example: 5
        partition_count:
          type: integer
          example: 3
        committed_partitions:
          type: integer
          example: 3
        last_rebalance_secs:
          type: integer
          format: int64
          example: 120

    # Pub/Sub Schemas
    PubSubStats:
      type: object
      properties:
        total_topics:
          type: integer
          example: 15
        total_subscribers:
          type: integer
          example: 50
        total_messages:
          type: integer
          format: int64
          example: 100000

    TopicInfo:
      type: object
      properties:
        topic:
          type: string
          example: notifications.email
        subscriber_count:
          type: integer
          example: 10
        message_count:
          type: integer
          format: int64
          example: 5000
        created_at:
          type: integer
          format: int64
          example: 1729598400

    # Bitmap Schemas
    BitfieldOperation:
      type: object
      required: [operation, offset, width]
      properties:
        operation:
          type: string
          enum: [GET, SET, INCRBY]
          description: Operation type
          example: GET
        offset:
          type: integer
          format: int64
          description: Bit offset (0-based)
          example: 0
        width:
          type: integer
          minimum: 1
          maximum: 64
          description: Bit width (1-64)
          example: 8
        signed:
          type: boolean
          description: Whether value is signed (default false)
          example: false
        value:
          type: integer
          format: int64
          description: Value for SET operation
          example: 42
        increment:
          type: integer
          format: int64
          description: Increment for INCRBY operation
          example: 10
        overflow:
          type: string
          enum: [WRAP, SAT, FAIL]
          description: Overflow behavior for INCRBY (default WRAP)
          example: WRAP

    BitmapStatsResponse:
      type: object
      properties:
        total_bitmaps:
          type: integer
          example: 1000
        total_bits:
          type: integer
          format: int64
          example: 1000000
        setbit_count:
          type: integer
          format: int64
          example: 50000
        getbit_count:
          type: integer
          format: int64
          example: 100000
        bitcount_count:
          type: integer
          format: int64
          example: 20000
        bitpos_count:
          type: integer
          format: int64
          example: 5000
        bitop_count:
          type: integer
          format: int64
          example: 1000
        bitfield_count:
          type: integer
          format: int64
          example: 5000

    HyperLogLogStatsResponse:
      type: object
      properties:
        total_hlls:
          type: integer
          description: Total number of HyperLogLog structures
          example: 50
        pfadd_count:
          type: integer
          format: int64
          description: Total number of PFADD operations
          example: 10000
        pfcount_count:
          type: integer
          format: int64
          description: Total number of PFCOUNT operations
          example: 5000
        pfmerge_count:
          type: integer
          format: int64
          description: Total number of PFMERGE operations
          example: 200
        total_cardinality:
          type: integer
          format: int64
          description: Sum of estimated cardinalities across all HyperLogLog structures
          example: 500000

    # Geospatial Schemas
    GeoradiusResult:
      type: object
      properties:
        member:
          type: string
          description: Member name
          example: San Francisco
        distance:
          type: number
          format: double
          nullable: true
          description: Distance from center (if withDist=true)
          example: 0.5
        coord:
          type: object
          nullable: true
          description: Coordinates (if withCoord=true)
          properties:
            lat:
              type: number
              format: double
              example: 37.7749
            lon:
              type: number
              format: double
              example: -122.4194

    GeospatialSearchRequest:
      type: object
      properties:
        from_member:
          type: string
          description: Center member (mutually exclusive with from_lonlat)
          example: San Francisco
        from_lonlat:
          type: array
          items:
            type: number
            format: double
          minItems: 2
          maxItems: 2
          description: Center coordinates as [lon, lat] (mutually exclusive with from_member)
          example: [-122.4194, 37.7749]
        by_radius:
          type: array
          items:
            type: number
            format: double
          minItems: 2
          maxItems: 2
          description: Search by radius as [radius, unit] where unit is 'm', 'km', 'mi', or 'ft' (mutually exclusive with by_box)
          example: [50, km]
        by_box:
          type: array
          items:
            type: number
            format: double
          minItems: 3
          maxItems: 3
          description: Search by bounding box as [width, height, unit] where unit is 'm', 'km', 'mi', or 'ft' (mutually exclusive with by_radius)
          example: [100000, 100000, m]
        with_dist:
          type: boolean
          description: Include distance in results
          default: false
        with_coord:
          type: boolean
          description: Include coordinates in results
          default: false
        with_hash:
          type: boolean
          description: Include geohash in results
          default: false
        count:
          type: integer
          description: Maximum number of results
          example: 10
        sort:
          type: string
          enum: [ASC, DESC]
          description: Sort order
          example: ASC

    GeospatialStatsResponse:
      type: object
      properties:
        total_keys:
          type: integer
          description: Total number of geospatial keys
          example: 100
        total_locations:
          type: integer
          description: Total number of geospatial locations
          example: 5000
        geoadd_count:
          type: integer
          format: int64
          description: Total number of GEOADD operations
          example: 10000
        geodist_count:
          type: integer
          format: int64
          description: Total number of GEODIST operations
          example: 5000
        georadius_count:
          type: integer
          format: int64
          description: Total number of GEORADIUS/GEOSEARCH operations
          example: 2000
        geopos_count:
          type: integer
          format: int64
          description: Total number of GEOPOS operations
          example: 3000
        geohash_count:
          type: integer
          format: int64
          description: Total number of GEOHASH operations
          example: 1500

    # Authentication Schemas
    UserInfo:
      type: object
      properties:
        username:
          type: string
          example: admin
        roles:
          type: array
          items:
            type: string
          example: [admin, readonly]
        is_admin:
          type: boolean
          example: true
        enabled:
          type: boolean
          example: true

    CreateKeyRequest:
      type: object
      required: [name]
      properties:
        name:
          type: string
          example: my-api-key
        expires_in_seconds:
          type: integer
          format: int64
          nullable: true
          description: Optional expiration time in seconds
          example: 86400
        permissions:
          type: array
          items:
            type: object
            properties:
              resource:
                type: string
                example: kv:*
              action:
                type: string
                enum: [read, write, delete, configure, admin, all]
                example: read
          nullable: true
        allowed_ips:
          type: array
          items:
            type: string
          nullable: true
          description: Optional list of allowed IP addresses
          example: ["192.168.1.1", "10.0.0.1"]

    CreateKeyResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        key:
          $ref: "#/components/schemas/ApiKeyInfo"
        message:
          type: string
          example: API key created successfully

    ApiKeyInfo:
      type: object
      properties:
        id:
          type: string
          example: key_abc123xyz
        key:
          type: string
          description: API key secret (only shown on creation)
          example: synap_sk_live_abc123xyz789
        name:
          type: string
          example: my-api-key
        expires_at:
          type: string
          format: date-time
          nullable: true
          example: "2025-12-31T23:59:59Z"
        created_at:
          type: string
          format: date-time
          example: "2025-11-25T12:00:00Z"

    CreateUserRequest:
      type: object
      required: [username, password]
      properties:
        username:
          type: string
          example: newuser
        password:
          type: string
          format: password
          example: SecurePassword123!
        roles:
          type: array
          items:
            type: string
          nullable: true
          example: [readonly]

    RoleInfo:
      type: object
      properties:
        name:
          type: string
          example: readonly
        description:
          type: string
          example: Read-only access to resources

security:
  - BasicAuth: []
  - BearerAuth: []
  - ApiKeyAuth: []
  - {} # Allow unauthenticated access (optional auth)

